#!/usr/bin/env bash

# https://rvm.io/rvm/security
keys=( 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB )
servers=(
  hkp://pool.sks-keyservers.net
  hkp://ipv4.pool.sks-keyservers.net
  hkp://pgp.mit.edu
  hkp://keyserver.pgp.com
)
code=

echo "409B6B1796C275462A1703113804BB82D39DC0E3:6:" | gpg --import-ownertrust
echo "7D2BAF1CF37B13E2069D6956105BD0E739499BDB:6:" | gpg --import-ownertrust

for server_name in "${servers[@]}"; do
  echo "Fetching keys from $server_name:"
  gpg --keyserver "$server_name" --recv-keys $(echo ${keys[@]})
  code=$?

  if [ "$code" -eq "0" ]
  then
    break
  else
    echo "Could not fetch from ${server_name}. Trying with a different server..."
  fi
done

\curl -sSL https://get.rvm.io | bash -s stable
